<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, inital-scale=1">
    <link rel="stylesheet" href="style.css" type="text/css">
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="targetCollector.js"></script>
    <style>
      #progress {
        width: 50%;
        background-color: black;
      }

      #progress-bar {
        width: 2%;
        height: 20px;
        background-color: #4CAF50;
      }
      h1, h2, h3, h4, h5, h6 { 
        font-family: cursive !important;
        font-weight: bold;
      }
      body {
          font-family: cursive !important;
          padding: 0;
          margin: 0;
          width: 100%;
          height: 100%;
      }
      button:hover {
          opacity: 0.8;
      }
    </style>
  </head>
  <body style="background-color:slategrey">
    <!-- header -->
    <header class="w3-container w3-center" style="background-color:slategrey;padding:128px 16px;">
      <canvas id="background" style="position:absolute;top:0;left:0;opacity:0.9"></canvas>
      <h1 class="w3-margin w3-jumbo" id="title" style="color:black;">targetCollector WebView</h1>
      <h1>Author: @holsick</h1>
    </header>
    <!-- end header -->
    
    <br><br><br><br>
    <p class="w3-xlarge w3-center">Click below to start collecting valid targets!</p>
    <div class="w3-center">
      <button id="fetch-data" class="w3-button w3-black w3-padding-large w3-large w3-margin-top" style="width:auto;border-radius:100px;">Fetch Data</button>
      <button id="result-btn" class="w3-button w3-black w3-padding-large w3-large w3-margin-top" style="width:auto;border-radius:100px;" data-toggle="modal" data-target="#resultModal">View Results</button><br><br><br>
      <p id="loading"></p><br>
      <div id="progress" style="margin:0 auto;visibility:hidden;">
        <div id="progress-bar" style="border-radius:100px;"></div>
      </div>
    </div>

    <!-- results displayed in this modal here -->
    <div class="modal fade right" id="resultModal" tabindex="-1" role="dialog" aria-labelledby="resultModal" aria-hidden="true">
      <div class="modal-dialog-full-width modal-dialog momodel modal-fluid" role="document">
        <div class="modal-content-full-width modal-content">
          <div class="modal-header modal-header-full-width text-center">
            <h5 class="modal-title w-100" id="resultModal"><a href="https://github.com/holsick/targetCollector">Documentation</a></h5>
          </div>
  
          <h1 class="section-heading text-center wow fadeIn my-5 pt-3" style="color:black;font-family:cursive;">targetCollector Results</h1>
          <div class="modal-footer modal-footer-full-width">
            <button type="button" id="clear-data" class="w3-button w3-black w3-padding-large w3-large" style="width:350px;float:left;border-radius:100px;" data-dismiss="modal">Close Results and Clear Data</button>
            <button type="button" id="copy" class="w3-button w3-black w3-padding-large w3-large" style="width:350px;border-radius:100px;">Save Results to File</button>
            <div class="modal-body">
              <div class="split left">
                <div style="float:left;">
                  <h2 style="color:green;font-family:cursive;">Live Domains Found</h2>
                  <hr class="horizontal">
                  <p style="float:left;text-align:left;" id="liveDomains"></p>
                </div>
              </div>
              
              <div class="split right">
                <div style="float:left;text-align:left;">
                  <h2 style="color:purple;font-family:cursive;">Detected Redirections</h2>
                  <hr class="horizontal">
                  <p style="float:left;" id="redirections"></p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- end modal -->

    <!-- footer -->
    <!-- end footer -->

    <script type="text/javascript">

      document.getElementById('title').focus();

      function checkProcessedFile() {
        var checkArray = targetCollector.collectedData.processedDomains;
        var isEmpty = checkArray.every(function(item) {
          return item == '';
        });
        return isEmpty;
      }

      function showProgress() {
        var element = document.getElementById('progress-bar');
        var width = 0;
        var identity = setInterval(scene, 10);
        element.style.visibility = 'visible';
        function scene() {
          if (width >= 100) {
            clearInterval(identity);
          } else {
            width++;
            element.style.width = width + '%';
            element.innerHTML = width * 1 + '%';
          }
        }
      }

      function saveToFile(content, filename, contentType) {
        var file = new Blob([content], { type: contentType });
        var a = document.createElement('a');
        a.href = URL.createObjectURL(file);
        a.download = filename;
        a.click();
        URL.revokeObjectURL(a.href);
      }

      function removeEmpty(arr) {
        var index = arr.indexOf('');
        if (index > -1) {
          arr.splice(index, 1);
        }
        return arr;
      }

      targetCollector.processFile();

      setTimeout(function() {
        var check = checkProcessedFile();
        if (check == true) {
          document.getElementById('loading').innerHTML = 'Your subdomains.txt file does not contain any data';
          document.getElementById('fetch-data').disabled = true;
        }
      }, 1000);

      document.getElementById('result-btn').addEventListener('click', function() {
        targetCollector.collectedData.liveDomains.forEach(function(entry) {
          document.getElementById('liveDomains').innerHTML += '<a href="' + entry + '">' + entry + '</a><br>';
        });
        targetCollector.collectedData.redirections.forEach(function(entry) {
          document.getElementById('redirections').innerHTML += entry + '<br>';
        });
      });

      document.getElementById('clear-data').addEventListener('click', function() {
        document.getElementById('liveDomains').innerHTML = '';
        document.getElementById('redirections').innerHTML = '';
      });

      document.getElementById('copy').addEventListener('click', function() {
        var timeWhenRan = new Date().toISOString().slice(0, 10);
        var liveDomainsArray = document.getElementById('liveDomains').innerText.split('\n');
        var redirectionsArray = document.getElementById('redirections').innerText.split('\n');
        var fullArray = removeEmpty(liveDomainsArray.concat(removeEmpty(redirectionsArray)));
        saveToFile(fullArray.join('\n'), 'results-' + timeWhenRan + '.txt', 'text/plain');
      });
      
      document.getElementById('fetch-data').addEventListener('click', function() {
        var loader = document.getElementById('loading');
        if (loader.innerHTML === 'DONE' || loader.innerHTML === 'Data already fetched. Please refresh') {
          loader.innerHTML = 'Data already fetched. Please refresh';
          return;
        }
        targetCollector.collectedData.processedDomains.forEach(function(subdomain) {
          setTimeout(function() {
            targetCollector.getStatus(subdomain);
            loader.innerHTML = 'DONE';
            document.getElementById('progress-bar').style.visibility = 'hidden';
          }, 2000);
          loader.innerHTML = 'Fetching Data...';
          showProgress();
        });
      });

      /* some sick js animations */
      (function () {
        var requestAnimationFrame = window.requestAnimationFrame || window.mozRequestAnimationFrame || 
        window.webkitRequestAnimationFrame || window.msRequestAnimationFrame || function(callback) {
          window.setTimeout(callback, 1000 / 60);
        };
        window.requestAnimationFrame = requestAnimationFrame;
      })();

      var background = document.getElementById('background');
      var backgroundContext = background.getContext('2d');
      var width = window.innerWidth;
      var height = 420;// can be changed

      //(height < 400) ? height = 400 : height; -- cap if needed

      background.width = width;
      background.height = height;
      background.style.borderBottom = '20px solid black';

      // canvas used for the stars
      backgroundContext.fillStyle = '#05004c';
      backgroundContext.fillRect(0, 0, width, height);

      // stars
      function Star(options) {
        this.size = Math.random() * 2;
        this.speed = Math.random() * 1;
        this.x = options.x;
        this.y = options.y;
      }

      Star.prototype.reset = function() {
        this.size = Math.random() * 2;
        this.speed = Math.random() * 1;
        this.x = width;
        this.y = Math.random() * height;
      };

      Star.prototype.update = function() {
        this.x -= this.speed;
        if (this.x < 0) {
          this.reset();
        } else {
          backgroundContext.fillRect(this.x, this.y, this.size, this.size);
        }
      };

      function ShootingStar() {
        this.reset();
      }

      ShootingStar.prototype.reset = function() {
        this.x = Math.random() * width;
        this.y = 0;
        this.len = (Math.random() * 80) + 10;
        this.speed = (Math.random() * 10) + 6;
        this.size = (Math.random() * 1) + 0.1;
        // this is used so the shooting stars arent constant
        this.waitTime = new Date().getTime() + (Math.random() * 3000) + 500;
        this.active = false;
      };

      ShootingStar.prototype.update = function() {
        if (this.active) {
          this.x -= this.speed;
          this.y += this.speed;
          if (this.x < 0 || this.y >= height) {
            this.reset();
          } else {
            backgroundContext.lineWidth = this.size;
            backgroundContext.beginPath();
            backgroundContext.moveTo(this.x, this.y);
            backgroundContext.lineTo(this.x + this.len, this.y - this.len);
            backgroundContext.stroke();
          }
        } else {
          if (this.waitTime < new Date().getTime()) {
            this.active = true;
          }
        }
      };

      var entities = [];

        // init the stars
      for (var i = 0; i < height; i++) {
        entities.push(new Star({
          x: Math.random() * width,
          y: Math.random() * height
        }));
      }

      entities.push(new ShootingStar());
      entities.push(new ShootingStar());

      function animate() {
        backgroundContext.fillStyle = '#110E19';
        backgroundContext.fillRect(0, 0, width, height);
        backgroundContext.fillStyle = '#ffffff';
        backgroundContext.strokeStyle = '#ffffff';

        var entLen = entities.length;

        while (entLen--) {
          entities[entLen].update();
        }
        requestAnimationFrame(animate);
      }

      animate();
    </script>
  </body>
</html>
